<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Csany Tamas - ChemAxon test UI</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">

    <link rel="stylesheet" href="/style/App.css">

    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://marvinjs.chemicalize.com/v1/50fdf5c59b7d4699bf380714cd25f7df/client-settings.js"></script>
    <script src="https://marvinjs.chemicalize.com/v1/client.js"></script>
</head>
<body>
    <header class="App-header">Csanyi Tamas - ChemAxon test</header>

    <div class="container searchFormContent">

        <div class="row">
            <div class="col-sm">
                <h3>Chemical details summary searcher</h3>
                <div>
                    <div class="row">
                        <div class="mb-1 col"><input type="text" th:field="*{datePlanted}" id="chemicalname" placeholder="Chemical name" class="form-control" /></div>
                        <div class="col"><button id="searchButton" class="btn btn-outline-primary">Search</button></div>
                    </div>
                </div>
            </div>

            <div class="col-sm">
                <table class="table">
                    <thead  id="summary_table_head">
                    <tr>
                        <td>Chemical name</td>
                        <td id="summary_table_chemical_name"></td>
                    </tr>
                    </thead>
                    <tbody id="summary_table_body">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row">
            <div class="col-sm">
                <div id="marvin-display-div" class="marvinBox"></div>
            </div>
        </div>
    </div>

    <script>
    var marvin = null;
    var currentElement = null;
    $(document).ready(() => {
      $('#summary_table_head').hide();
      $('#marvin-display-div').hide();
      $('#searchButton').prop('disabled', true);

      $('#chemicalname').on('input',function(e){
        if ($('#chemicalname').val() == '') {
            $('#searchButton').prop('disabled', true);
        } else {
            $('#searchButton').prop('disabled', false);
        }
      });

      $('#searchButton').click(() => {
        if ( $('#chemicalname').val() != currentElement ) {
          currentElement = $('#chemicalname').val();
          $.getJSON("/api/v1/description/summary?name="+$('#chemicalname').val(), result => {
            if ( result instanceof Array ) {
              $('#summary_table_head').show();
              $('#summary_table_chemical_name').html($('#chemicalname').val());
              $('#summary_table_body').html(result.map( element => {
                return '<tr><td>'+element.label+'</td><td>'+element.value.toString()+'</td></tr>';
              }));
              marvin.importStructure3d();
              marvin.importStructure3d("name", $('#chemicalname').val());
              $('#marvin-display-div').show();
            }
          }).fail((err) => {
             console.error(err);
             $('#summary_table_head').hide();
             $('#marvin-display-div').hide();
             $('#summary_table_body').html(
               '<tr><td><div class="alert alert-danger" role="alert">Error during querying Chemicalize Pro (status '+err.responseJSON.status+'): '+JSON.parse(err.responseJSON.message).message+'</div></td></tr>'
             );
          });
        }
      });

      ChemicalizeMarvinJs.createEditor("#marvin-display-div").then( (marvinResult) => {
        marvinResult.setDisplaySettings({
            toolbars: "view3d",
            displayMode: "BALLSTICK",
            defaultTool: "rotate3d",
            implicitHydrogen: "OFF",
            chiralFlagVisible: false,
            valenceErrorVisible: false,
            disableContextMenu: true,
         });
         marvin = marvinResult;
      });
    });
    </script>


</body>
</html>